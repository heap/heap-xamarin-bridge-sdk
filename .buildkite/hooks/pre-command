#!/usr/bin/env bash
#
# GENERATED BY TERRAFORM: /context/meta/terraform_modules/source_repo/
# DO NOT REMOVE/RENAME! EDIT CAUTIOUSLY!
#
# This standard script is responsible for pre-loading secrets from Vault into environment
# variables that might be used by build steps.

set -euo pipefail
echo 'Setting VAULT_TOKEN with a limited-TTL delegate and GITHUB_TOKEN'

VAULT_TOKEN=$(VAULT_ADDR=http://127.0.0.1:8200 vault token create -explicit-max-ttl 15m -field token 2>/dev/null || echo "")
export VAULT_TOKEN

GITHUB_TOKEN=$(VAULT_ADDR=http://127.0.0.1:8200 vault read -field token config/heap/github/api_token)
export GITHUB_TOKEN

SLACK_TOKEN=$(VAULT_ADDR=http://127.0.0.1:8200 vault read -field token config/heap/secrets/buildkite_slack)
export SLACK_TOKEN

# Set of tokens used by `context/foundation/build_system/build_annotation/` for
# PR annotation and comments.
GITHUB_APP_ID=$(VAULT_ADDR=http://127.0.0.1:8200 vault read -field app_id config/heap/github/quality_app)
GITHUB_APP_INSTALLATION_ID=$(VAULT_ADDR=http://127.0.0.1:8200 vault read -field app_installation_id config/heap/github/quality_app)
GITHUB_APP_PRIVATE_KEY=$(VAULT_ADDR=http://127.0.0.1:8200 vault read -field private_key config/heap/github/quality_app)
export GITHUB_APP_ID
export GITHUB_APP_INSTALLATION_ID
export GITHUB_APP_PRIVATE_KEY
